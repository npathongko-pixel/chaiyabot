<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏™‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞: ‡πÅ‡∏ä‡∏ó‡∏ö‡∏≠‡∏ó‡∏ß‡∏±‡∏î‡∏û‡∏£‡∏∞‡∏ò‡∏≤‡∏ï‡∏∏‡πÑ‡∏ä‡∏¢‡∏≤ (Fixed Visibility)</title>

  <style>
    /* 1.1 ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; font-family: 'Sarabun', Arial, sans-serif; overflow: hidden; }

    /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
    body {
      background:
        linear-gradient(180deg, rgba(250,243,224,0.75) 0%, rgba(251,248,232,0.75) 60%, rgba(224,202,143,0.85) 100%),
        url("wat-bg.webp") center/cover no-repeat fixed; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô URL ‡∏£‡∏π‡∏õ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì */
      display: flex; align-items: center; justify-content: center;
    }

    /* 1.2 ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å (Main Box) */
    #content-wrapper {
      text-align: center; color: #5C4033;
      background: rgba(255, 255, 255, 0.85);
      border-radius: 20px; padding: 40px;
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
      transition: opacity 0.5s ease, transform 0.5s ease;
      z-index: 2; position: relative; min-width: 320px;
    }
    #content-wrapper.hidden { opacity: 0; pointer-events: none; transform: scale(0.8); }

    /* ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ô‡πâ‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏ß‡∏¥ (‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà) */
    #nong-srivi-model {
      width: 180px; height: 180px; margin: 0 auto 20px auto; position: relative;
      animation: float 6s ease-in-out infinite;
    }
    .character-body {
      width: 120px; height: 140px; background: linear-gradient(135deg, #FFD700, #FFA500);
      border-radius: 50% 50% 60% 60%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      box-shadow: 0 10px 30px rgba(212, 175, 55, 0.5);
    }
    .character-head {
      width: 90px; height: 90px; background: linear-gradient(135deg, #FFE4B5, #FFDAB9);
      border-radius: 50%; position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .character-eye {
      width: 12px; height: 12px; background: #2C1810; border-radius: 50%; position: absolute; top: 35px; animation: blink 3s infinite;
    }
    .character-eye.left { left: 25px; } .character-eye.right { right: 25px; }
    .character-smile {
      width: 30px; height: 15px; border: 3px solid #2C1810; border-top: none; border-radius: 0 0 30px 30px;
      position: absolute; top: 55px; left: 50%; transform: translateX(-50%);
    }

    #start-chat-button {
      background-color: #D4AF37; color: #5C4033; border: none; border-radius: 50px;
      padding: 15px 40px; font-size: 1.2em; font-weight: bold; cursor: pointer;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); transition: all 0.3s ease; margin-top: 15px;
    }
    #start-chat-button:hover { transform: scale(1.05); box-shadow: 0 8px 20px rgba(212, 175, 55, 0.5); }

    /* ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö */
    #back-button {
      position: fixed; bottom: 20px; left: 20px; z-index: 5; padding: 10px 18px;
      border-radius: 999px; border: none; background: rgba(0,0,0,0.55); color: #fff; cursor: pointer;
    }

    /* Animation */
    @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-20px); } 100% { transform: translateY(0px); } }
    @keyframes blink { 0%, 48%, 52%, 100% { height: 12px; } 50% { height: 2px; } }

    /* 1.3 ‡∏ô‡πâ‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏ß‡∏¥‡∏à‡∏¥‡πã‡∏ß (‡∏ö‡∏±‡∏á‡∏õ‡∏∏‡πà‡∏°) */
    #srivi-button-cover {
      position: fixed; bottom: 16px; right: 16px; width: 65px; height: 65px; z-index: 1000;
      pointer-events: none; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏∞‡∏•‡∏∏ */
      animation: float-small 4s ease-in-out infinite;
      display: none; opacity: 0; transition: opacity 0.5s ease;
    }
    #srivi-button-cover.visible { display: block; opacity: 1; }
    @keyframes float-small { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-5px); } }

    /* ‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡∏à‡∏¥‡πã‡∏ß */
    #srivi-button-cover .srivi-body-small {
      width: 50px; height: 55px; background: linear-gradient(135deg, #FFD700, #FFA500);
      border-radius: 50% 50% 60% 60%; position: absolute; top: 55%; left: 50%; transform: translate(-50%, -50%);
    }
    #srivi-button-cover .srivi-head-small {
      width: 40px; height: 40px; background: linear-gradient(135deg, #FFE4B5, #FFDAB9);
      border-radius: 50%; position: absolute; top: 5px; left: 50%; transform: translateX(-50%);
    }
    #srivi-button-cover .srivi-eye-small {
      width: 5px; height: 5px; background: #2C1810; border-radius: 50%; position: absolute; top: 16px; animation: blink 3s infinite;
    }
    #srivi-button-cover .srivi-eye-small.left { left: 10px; } #srivi-button-cover .srivi-eye-small.right { right: 10px; }
    #srivi-button-cover .srivi-smile-small {
      width: 12px; height: 6px; border: 2px solid #2C1810; border-top: none; border-radius: 0 0 12px 12px;
      position: absolute; top: 24px; left: 50%; transform: translateX(-50%);
    }

    /* 1.4 ‡∏ô‡πâ‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏ß‡∏¥‡∏ö‡∏¥‡∏ô */
    #flying-srivi {
      position: fixed; width: 80px; height: 80px; z-index: 1000; pointer-events: none; display: none;
      top: 50%; left: 50%; transform: translate(-50%, -50%);
    }
    #flying-srivi.flying { display: block; animation: fly-to-chat 1.5s cubic-bezier(0.68,-0.55,0.265,1.55) forwards; }
    @keyframes fly-to-chat {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0) rotate(0deg); }
      20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2) rotate(20deg); }
      100% { opacity: 0; transform: translate(calc(50vw - 80px), calc(50vh - 80px)) scale(0.5) rotate(360deg); }
    }

    /* 1.5 Dialogflow Customization */
    df-messenger {
      --df-messenger-button-titlebar-color: #D4AF37;
      --df-messenger-header-background-color: linear-gradient(90deg,#D4AF37,#E5C158);
      --df-messenger-user-message-background-color: #D4AF37;
      --df-messenger-chat-background-color: transparent;
      --df-messenger-send-icon: #D4AF37;
      z-index: 999;
      --df-messenger-button-icon-color: transparent;
      
      /* üî• ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô! ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏á‡πÅ‡∏™‡∏î‡∏á */
      display: none;
    }
  </style>
</head>
<body>

  <div id="content-wrapper">
    <div id="nong-srivi-model">
      <div class="character-body"></div>
      <div class="character-head">
        <div class="character-eye left"></div><div class="character-eye right"></div><div class="character-smile"></div>
      </div>
    </div>
    <h1>‡∏ô‡πâ‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏ß‡∏¥ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h1>
    <p>‡∏°‡∏±‡∏Ñ‡∏Ñ‡∏∏‡πÄ‡∏ó‡∏®‡∏Å‡πå AI ‡πÅ‡∏´‡πà‡∏á‡∏ß‡∏±‡∏î‡∏û‡∏£‡∏∞‡∏ò‡∏≤‡∏ï‡∏∏‡πÑ‡∏ä‡∏¢‡∏≤</p>
    <button id="start-chat-button">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏ô‡∏ó‡∏ô‡∏≤</button>
  </div>

  <button id="back-button">‚üµ ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>

  <div id="flying-srivi">
     <div class="srivi-body-small" style="width: 50px; height: 55px; background: linear-gradient(135deg, #FFD700, #FFA500); border-radius: 50% 50% 60% 60%; position: absolute; top: 55%; left: 50%; transform: translate(-50%, -50%);"></div>
     <div class="srivi-head-small" style="width: 40px; height: 40px; background: linear-gradient(135deg, #FFE4B5, #FFDAB9); border-radius: 50%; position: absolute; top: 5px; left: 50%; transform: translateX(-50%);"></div>
  </div>

  <div id="srivi-button-cover">
    <div class="srivi-body-small"></div>
    <div class="srivi-head-small">
      <div class="srivi-eye-small left"></div><div class="srivi-eye-small right"></div><div class="srivi-smile-small"></div>
    </div>
  </div>

  <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
  <df-messenger
    chat-title="‡∏ô‡πâ‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏ß‡∏¥ (AI Guide)"
    agent-id="2f3ad8d0-abd6-49dd-a7ac-ad9024c74e62"
    language-code="th"
    intent="WELCOME">
  </df-messenger>

  <script>
    // --- ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£) ---
    function speak(text) {
      if ("speechSynthesis" in window) {
        window.speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = "th-TH";
        window.speechSynthesis.speak(utter);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
       const startBtn = document.getElementById('start-chat-button');
       const contentWrapper = document.getElementById('content-wrapper');
       const flyingSrivi = document.getElementById('flying-srivi');
       const sriviCover = document.getElementById('srivi-button-cover');
       
       startBtn.addEventListener('click', () => {
         // 1. ‡∏û‡∏π‡∏î‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö
         speak("‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞ ‡∏ô‡πâ‡∏≠‡∏á‡∏®‡∏£‡∏µ‡∏ß‡∏¥ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏∞");
         
         // 2. ‡∏ã‡πà‡∏≠‡∏ô‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
         contentWrapper.classList.add('hidden'); 
         
         // 3. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏¥‡∏ô
         flyingSrivi.classList.add('flying');
         
         // 4. ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏ó‡∏µ‡πà‡∏ö‡∏¥‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 1.4 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
         setTimeout(() => {
           // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏ö‡∏±‡∏á‡∏õ‡∏∏‡πà‡∏°
           sriviCover.classList.add('visible');
           
           // üî• ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏õ‡∏•‡∏∏‡∏Å‡πÅ‡∏ä‡∏ó‡∏ö‡∏≠‡∏ó‡πÉ‡∏´‡πâ‡∏ï‡∏∑‡πà‡∏ô (‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏≠‡∏Å‡∏°‡∏≤)
           const dfMessenger = document.querySelector('df-messenger');
           if (dfMessenger) {
             dfMessenger.style.display = 'block'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å none ‡πÄ‡∏õ‡πá‡∏ô block
           }

           // ‡∏£‡∏≠‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô Render ‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡∏™‡∏±‡πà‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏õ‡∏¥‡∏î
           setTimeout(() => {
             if (dfMessenger && dfMessenger.shadowRoot) {
                const floatBtn = dfMessenger.shadowRoot.querySelector('df-floating-button') || dfMessenger.shadowRoot.querySelector('button');
                if (floatBtn) floatBtn.click();
             }
           }, 100);

         }, 1400);

         setTimeout(() => { flyingSrivi.style.display = 'none'; }, 1600);
       });

       document.getElementById('back-button').onclick = () => { history.back(); };
    });

    // --- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ä‡∏ó ---
    window.addEventListener("dfMessengerLoaded", function () {
      const dfMessenger = document.querySelector('df-messenger');
      setTimeout(() => {
          if (!dfMessenger || !dfMessenger.shadowRoot) return;
          const shadow = dfMessenger.shadowRoot;
          const internalChatContainer = shadow.querySelector('.chat-wrapper');
          if (internalChatContainer) {
            const bgUrl = "https://raw.githubusercontent.com/TAMMAZA/Wat/main/image/2.jpeg";
            internalChatContainer.style.backgroundImage = `url('${bgUrl}')`;
            internalChatContainer.style.backgroundSize = "cover";
            internalChatContainer.style.backgroundPosition = "center center";
            internalChatContainer.style.backgroundRepeat = "no-repeat";
            internalChatContainer.style.backgroundColor = "transparent";
          }
      }, 1000);
    });
  </script>
</body>
</html>
